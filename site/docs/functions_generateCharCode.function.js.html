<!doctypehtml><html lang=en><meta charset=utf-8><meta content="A JavaScript password generator"name=description><meta content=#636980 name=theme-color><meta content="simplePass | Source: functions/generateCharCode.function.js"property=og:title><meta content=website property=og:type><meta content=https://staticbanter.github.io/simplePass/ property=og:url><meta content="simplePass documentation page for Source: functions/generateCharCode.function.js"property=og:description><meta content=en_CA property=og:locale><meta content=GitHub property=og:site_name><link href=../storage/icons/simplePass-Logo-1080.png rel=apple-touch-icon><link href=../manifest.json rel=manifest><link href=../storage/icons/simplePass-Logo-512.png rel=icon type=image/png><title>simplePass Docs: Source: functions/generateCharCode.function.js</title><script src=scripts/prettify/prettify.js></script><script src=scripts/prettify/lang-css.js></script><!--[if lt IE 9]><script src=//html5shiv.googlecode.com/svn/trunk/html5.js></script><![endif]--><link href=styles/prettify-tomorrow.css rel=stylesheet><link href=styles/jsdoc-default.css rel=stylesheet><div id=main><h1 class=page-title>Source: functions/generateCharCode.function.js</h1><section><article><pre class="linenums prettyprint source"><code>'use strict';
import config from "../simplePass.config.js";
import errors from "../data/enums/errors.enum.js";
import characterCodeConstraints from "../data/objects/characterCodeConstraints.object.js";
import createMessage from "./createMessage.function.js";
/**
 * @file
 * @module generateCharCode
 */
/**
 * Generates a random integer of a requested type.
 *
 * @function generateCharCode
 * @param {charCodeRequest} charCodeRequest An object contain the properties that describes the type of character code being requested
 * and restrictions being place on it.
 * @param {charCodeGenerationFlag} [flags] A flag object used to give more information about what stage of password generation we are at.
 * @requires characterCodeConstraints
 * @requires createMessage
 * @throws {errors.nonGenerableCharacterType} Will throw an error if the requested character code type
 * is not found within the character code constraints object.
 * @returns {number} An integer representing a UTF-16 character code unit. The integer will be within range of the defined character code request constraints.
 */
export default function generateCharCode(charCodeRequest, flags) {
    // Generate our random number.
    const charCode = self.crypto.getRandomValues(new Uint8Array(1))[0];
    /**
     * If the 'excluded characters' attribute is set,
     * If the 'excluded characters' contains the newly generated string,
     * regenerate a new string.
     */
    if (charCodeRequest.charCodeOptions?.excludeCharacters) {
        if (charCodeRequest.charCodeOptions.excludeCharacters.includes(String.fromCharCode(charCode))) {
            return generateCharCode(charCodeRequest);
        }
    }
    /**
     * Check for flags.
     */
    if (flags) {
        /**
         * Do things at the beginning of the password.
         */
        if (flags?.beginning) {
            /**
             * If a white-space is optional at the beginning of the password,
             * and the charCode is 32,
             * return the charCode.
             * Else regenerate.
             */
            if (charCodeRequest.charCodeOptions?.whitespaceOptions?.includes('whitespaceBeginning')
                && charCode === 32) {
                return charCode;
            }
            else if (charCode === 32) {
                return generateCharCode(charCodeRequest, flags);
            }
        }
        /**
         * Do things at the end of the password.
         */
        if (flags?.end) {
            /**
             * If a whitespace is optional at the end of the password,
             * and the charCode is 32,
             * return the charCode.
             * Else regenerate.
             */
            if (charCodeRequest.charCodeOptions?.whitespaceOptions?.includes('whitespaceEnd')
                && charCode === 32) {
                return charCode;
            }
            else if (charCode === 32) {
                return generateCharCode(charCodeRequest, flags);
            }
        }
    }
    /**
     * If the requested character type is within our character code constraints,
     * preform further checks to determine if it's the correct character code we
     * want.
     * Else throw an error, we can not check for the requested character type.
     */
    if (characterCodeConstraints[charCodeRequest.charType]) {
        /**
         * If the character code we are requesting only has a single constraint,
         * we can preform a direct comparison on it to determine if it's the one
         * we want.
         * Else continue as the constraint may have more attributes that we can
         * test for.
         */
        if (characterCodeConstraints[charCodeRequest.charType]?.single
            && characterCodeConstraints[charCodeRequest.charType]?.single === charCode) {
            return charCode;
        }
        /**
         * Initialize these three attributes as they are used in a combination of
         * comparisons.
         */
        const min = characterCodeConstraints[charCodeRequest.charType]?.min;
        const max = characterCodeConstraints[charCodeRequest.charType]?.max;
        const range = characterCodeConstraints[charCodeRequest.charType]?.range;
        /**
         * If the character code we are looking for exists in a range of codes.
         * If the generated charCode is within the min or max of that range.
         * If the generated charCode is equal to our min or max, we can just return it.
         * Iterate over our range;
         *  If our generated charCode exists somewhere in there, return it.
         */
        if (range) {
            if ((min
                && max)
                && (charCode >= min
                    && charCode &lt;= max)) {
                if (charCode === min
                    || charCode === max) {
                    return charCode;
                }
                for (let i = 0; i &lt; range.length; i++) {
                    if ((range[i][0]
                        && range[i][1])
                        && (charCode >= range[i][0]
                            && charCode &lt;= range[i][1])) {
                        return charCode;
                    }
                    else if (range[i][0]
                        && charCode === range[i][0]) {
                        return charCode;
                    }
                }
            }
        }
        else if (
        // ^ Else there was no range attribute and we only need to check the min and max.
        (min
            && max)
            && (charCode >= min
                && charCode &lt;= max)) {
            return charCode;
        }
    }
    else {
        throw new Error(createMessage(errors.nonGenerableCharacterType, [config.errorMessagePrefix, 'gCC', '1', charCodeRequest.charType]));
    }
    /**
     * We did not find our character.
     * Regenerate.
     */
    return generateCharCode(charCodeRequest, flags);
}
</code></pre></article></section></div><nav><b><a href=../index.html>simplePass Program</a></b><h3><a href=index.html>README</a></h3><h3>Modules</h3><ul><li><a href=module-allowedModifiers.html>allowedModifiers</a><li><a href=module-calculateMaxPossibleCharacters.html>calculateMaxPossibleCharacters</a><li><a href=module-characterCodeConstraints.html>characterCodeConstraints</a><li><a href=module-characterStrengthCheck.html>characterStrengthCheck</a><li><a href=module-cleanModifier.html>cleanModifier</a><li><a href=module-config.html>config</a><li><a href=module-createMessage.html>createMessage</a><li><a href=module-createModifierList.html>createModifierList</a><li><a href=module-ensureRepeatingCharacters.html>ensureRepeatingCharacters</a><li><a href=module-errors.html>errors</a><li><a href=module-generateCharCode.html>generateCharCode</a><li><a href=module-passwordPreConfigs.html>passwordPreConfigs</a><li><a href=module-requiredAttributes.html>requiredAttributes</a><li><a href=module-shuffle.html>shuffle</a><li><a href=module-simplePass.html>simplePass</a><li><a href=module-strengthChecker.html>strengthChecker</a><li><a href=module-strengthScores.html>strengthScores</a><li><a href=module-useableAttributes.html>useableAttributes</a><li><a href=module-validateModifier.html>validateModifier</a><li><a href=module-whitespaceAttributes.html>whitespaceAttributes</a></ul><h3>Interfaces</h3><ul><li><a href=charCodeGenerationFlag.html>charCodeGenerationFlag</a><li><a href=charCodeOptions.html>charCodeOptions</a><li><a href=charCodeRequest.html>charCodeRequest</a><li><a href=characterCodeConstraintsAttributes.html>characterCodeConstraintsAttributes</a><li><a href=characterSetObject.html>characterSetObject</a><li><a href=characterStrengthCheckConstraints.html>characterStrengthCheckConstraints</a><li><a href=configHTMLForm.html>configHTMLForm</a><li><a href=ensureRepeatingCharacterOptions.html>ensureRepeatingCharacterOptions</a><li><a href=passwordModifier.html>passwordModifier</a><li><a href=repeatingCharacterOptionsPreservations.html>repeatingCharacterOptionsPreservations</a><li><a href=strengthCheckedPassword.html>strengthCheckedPassword</a><li><a href=strengthCheckerConstraints.html>strengthCheckerConstraints</a><li><a href=strengthCheckerStyling.html>strengthCheckerStyling</a><li><a href=strengthScoreAttributes.html>strengthScoreAttributes</a></ul><h3>Other Resources</h3><ul><li><a href=tutorial-CODE_OF_CONDUCT.html>Code Of Conduct</a><li><a href=tutorial-CONTRIBUTING.html>Contributing</a><li><a href=tutorial-DEVELOPMENT.html>DEVELOPMENT</a><li><a href=tutorial-EXAMPLES.html>EXAMPLES</a><li><a href=tutorial-SECURITY.html>Security</a></ul></nav><br class=clear><footer>Documentation generated by <a href=https://github.com/jsdoc/jsdoc>JSDoc 4.0.0</a></footer><script>prettyPrint()</script><script src=scripts/linenumber.js></script>